<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    💤ISpiker
</title>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta name="author" content="💤ISpiker">
<meta name="description" content="The proof is in the pudding.">
<meta name="keywords" content="The proof is in the pudding.">
<link rel="stylesheet" href="https://hehelv.github.io//media/css/main.css" />
<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">
<script src="https://hehelv.github.io//media/script/tocbot.min.js"></script>
<script src="https://hehelv.github.io//media/script/script.js"></script>
<!--<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/default.min.css">
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>-->
<script src="https://cdn.bootcss.com/highlight.js/9.13.1/highlight.min.js"></script>
<link href="https://cdn.bootcss.com/highlight.js/9.13.1/styles/atelier-estuary-dark.min.css" rel="stylesheet">
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="https://hehelv.github.io/">
                    💤ISpiker
                </a>
            </div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/">
                        Home
                    </a>
                    
                    <a class="menu-item" href="/archives">
                        Archives
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        Tags
                    </a>
                    
                    <a class="menu-item" href="/post/about">
                        About
                    </a>
                    
                    <a class="menu-item" href="/tag/algorithm">
                        Algorithm
                    </a>
                    
                    <a class="menu-item" href="/tag/networking">
                        Computer Networking
                    </a>
                    
                    <a class="menu-item" href="/tag/Spider Note">
                        Spider Note
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="https://hehelv.github.io/">
                            💤ISpiker
                        </a>
                        <a id="mobile-toggle-theme">&nbsp;Light</a>
                    </div>
                    <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/">
                            Home
                        </a>
                        
                        <a class="menu-item" href="/archives">
                            Archives
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            Tags
                        </a>
                        
                        <a class="menu-item" href="/post/about">
                            About
                        </a>
                        
                        <a class="menu-item" href="/tag/algorithm">
                            Algorithm
                        </a>
                        
                        <a class="menu-item" href="/tag/networking">
                            Computer Networking
                        </a>
                        
                        <a class="menu-item" href="/tag/Spider Note">
                            Spider Note
                        </a>
                        
                </div>
            </div>
        </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.classList.contains("active")) {
            toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        } else {
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                13-动态网页爬虫
                            </h1>
                            <div class="post-meta">
                                Author:
                                <a itemprop="author" rel="author" href="/">
                                    💤ISpiker
                                </a>
                                <span class="post-time">
                                Date: <a href="#">2020-03-03</a>
                            </span>
                                
                                    <span class="post-category">
                                Category:
                                
                                <a href="https://hehelv.github.io//tag/Spider Note">Python爬虫笔记</a>
                                
                            </span>
                                    
                            </div>
                        </header>

                        <div class="post-content">
                            <h1 id="13-动态网页爬虫">13-动态网页爬虫</h1>
<h2 id="什么是ajax">什么是AJAX：</h2>
<p>AJAX（Asynchronouse JavaScript And XML）异步JavaScript和XML。过在后台与服务器进行少量数据交换，Ajax 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。传统的网页（不使用Ajax）如果需要更新内容，必须重载整个网页页面。因为传统的在传输数据格式方面，使用的是<code>XML</code>语法。因此叫做<code>AJAX</code>，其实现在数据交互基本上都是使用<code>JSON</code>。使用AJAX加载的数据，即使使用了JS，将数据渲染到了浏览器中，在<code>右键-&gt;查看网页源代码</code>还是不能看到通过ajax加载的数据，只能看到使用这个url加载的html代码。</p>
<h2 id="获取ajax数据的方式">获取ajax数据的方式：</h2>
<ol>
<li>直接分析ajax调用的接口。然后通过代码请求这个接口。</li>
<li>使用Selenium+chromedriver模拟浏览器行为获取数据。</li>
</ol>
<table>
<thead>
<tr>
<th>方式</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td>分析接口</td>
<td>直接可以请求到数据。不需要做一些解析工作。代码量少，性能高。</td>
<td>分析接口比较复杂，特别是一些通过js混淆的接口，要有一定的js功底。容易被发现是爬虫。</td>
</tr>
<tr>
<td>selenium</td>
<td>直接模拟浏览器的行为。浏览器能请求到的，使用selenium也能请求到。爬虫更稳定。</td>
<td>代码量多。性能低。</td>
</tr>
</tbody>
</table>
<h2 id="seleniumchromedriver获取动态数据">Selenium+chromedriver获取动态数据：</h2>
<p><code>Selenium</code>相当于是一个机器人。可以模拟人类在浏览器上的一些行为，自动处理浏览器上的一些行为，比如点击，填充数据，删除cookie等。<code>chromedriver</code>是一个驱动<code>Chrome</code>浏览器的驱动程序，使用他才可以驱动浏览器。当然针对不同的浏览器有不同的driver。以下列出了不同浏览器及其对应的driver：</p>
<ol>
<li>Chrome：https://sites.google.com/a/chromium.org/chromedriver/downloads</li>
<li>Firefox：https://github.com/mozilla/geckodriver/releases</li>
<li>Edge：https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/</li>
<li>Safari：https://webkit.org/blog/6900/webdriver-support-in-safari-10/</li>
</ol>
<h2 id="安装selenium和chromedriver">安装Selenium和chromedriver：</h2>
<ol>
<li>
<p>安装</p>
<pre><code>Selenium
</code></pre>
<p>：</p>
<pre><code>Selenium
</code></pre>
<p>有很多语言的版本，有java、ruby、python等。我们下载python版本的就可以了。</p>
<pre><code class="language-shell"> pip install selenium
</code></pre>
</li>
<li>
<p>安装<code>chromedriver</code>：下载完成后，放到不需要权限的纯英文目录下就可以了。</p>
</li>
</ol>
<h3 id="快速入门">快速入门：</h3>
<p>现在以一个简单的获取百度首页的例子来讲下<code>Selenium</code>和<code>chromedriver</code>如何快速入门：</p>
<pre><code class="language-python">from selenium import webdriver

# chromedriver的绝对路径
driver_path = r'D:\ProgramApp\chromedriver\chromedriver.exe'

# 初始化一个driver，并且指定chromedriver的路径
driver = webdriver.Chrome(executable_path=driver_path)
# 请求网页
driver.get(&quot;https://www.baidu.com/&quot;)
# 通过page_source获取网页源代码
print(driver.page_source)
</code></pre>
<h3 id="selenium常用操作">selenium常用操作：</h3>
<p>更多教程请参考：http://selenium-python.readthedocs.io/installation.html#introduction</p>
<h4 id="关闭页面">关闭页面：</h4>
<ol>
<li><code>driver.close()</code>：关闭当前页面。</li>
<li><code>driver.quit()</code>：退出整个浏览器。</li>
</ol>
<h4 id="定位元素">定位元素：</h4>
<ol>
<li>
<pre><code>find_element_by_id
</code></pre>
<p>：根据id来查找某个元素。等价于：</p>
<pre><code class="language-python"> submitTag = driver.find_element_by_id('su')
 submitTag1 = driver.find_element(By.ID,'su')
</code></pre>
</li>
<li>
<pre><code>find_element_by_class_name
</code></pre>
<p>：根据类名查找元素。 等价于：</p>
<pre><code class="language-python"> submitTag = driver.find_element_by_class_name('su')
 submitTag1 = driver.find_element(By.CLASS_NAME,'su')
</code></pre>
</li>
<li>
<pre><code>find_element_by_name
</code></pre>
<p>：根据name属性的值来查找元素。等价于：</p>
<pre><code class="language-python"> submitTag = driver.find_element_by_name('email')
 submitTag1 = driver.find_element(By.NAME,'email')
</code></pre>
</li>
<li>
<pre><code>find_element_by_tag_name
</code></pre>
<p>：根据标签名来查找元素。等价于：</p>
<pre><code class="language-python"> submitTag = driver.find_element_by_tag_name('div')
 submitTag1 = driver.find_element(By.TAG_NAME,'div')
</code></pre>
</li>
<li>
<pre><code>find_element_by_xpath
</code></pre>
<p>：根据xpath语法来获取元素。等价于：</p>
<pre><code class="language-python"> submitTag = driver.find_element_by_xpath('//div')
 submitTag1 = driver.find_element(By.XPATH,'//div')
</code></pre>
</li>
<li>
<p><code>find_element_by_css_selector</code>：根据css选择器选择元素。等价于：</p>
<pre><code class="language-python"> submitTag = driver.find_element_by_css_selector('//div')
 submitTag1 = driver.find_element(By.CSS_SELECTOR,'//div')
</code></pre>
<p>要注意，<code>find_element</code>是获取第一个满足条件的元素。<code>find_elements</code>是获取所有满足条件的元素。</p>
</li>
</ol>
<h4 id="操作表单元素">操作表单元素：</h4>
<ol>
<li>
<p>操作输入框：分为两步。第一步：找到这个元素。第二步：使用<code>send_keys(value)</code>，将数据填充进去。示例代码如下：</p>
<pre><code class="language-python"> inputTag = driver.find_element_by_id('kw')
 inputTag.send_keys('python')
</code></pre>
<p>使用<code>clear</code>方法可以清除输入框中的内容。示例代码如下：</p>
<pre><code class="language-python"> inputTag.clear()
</code></pre>
</li>
<li>
<p>操作checkbox：因为要选中<code>checkbox</code>标签，在网页中是通过鼠标点击的。因此想要选中<code>checkbox</code>标签，那么先选中这个标签，然后执行<code>click</code>事件。示例代码如下：</p>
<pre><code class="language-python"> rememberTag = driver.find_element_by_name(&quot;rememberMe&quot;)
 rememberTag.click()
</code></pre>
</li>
<li>
<p>选择select：select元素不能直接点击。因为点击后还需要选中元素。这时候selenium就专门为select标签提供了一个类<code>selenium.webdriver.support.ui.Select</code>。将获取到的元素当成参数传到这个类中，创建这个对象。以后就可以使用这个对象进行选择了。示例代码如下：</p>
<pre><code class="language-python"> from selenium.webdriver.support.ui import Select
 # 选中这个标签，然后使用Select创建对象
 selectTag = Select(driver.find_element_by_name(&quot;jumpMenu&quot;))
 # 根据索引选择
 selectTag.select_by_index(1)
 # 根据值选择
 selectTag.select_by_value(&quot;http://www.95yueba.com&quot;)
 # 根据可视的文本选择
 selectTag.select_by_visible_text(&quot;95秀客户端&quot;)
 # 取消选中所有选项
 selectTag.deselect_all()
</code></pre>
</li>
<li>
<p>操作按钮：操作按钮有很多种方式。比如单击、右击、双击等。这里讲一个最常用的。就是点击。直接调用<code>click</code>函数就可以了。示例代码如下：</p>
<pre><code class="language-python"> inputTag = driver.find_element_by_id('su')
 inputTag.click()
</code></pre>
</li>
</ol>
<h4 id="行为链">行为链：</h4>
<p>有时候在页面中的操作可能要有很多步，那么这时候可以使用鼠标行为链类<code>ActionChains</code>来完成。比如现在要将鼠标移动到某个元素上并执行点击事件。那么示例代码如下：</p>
<pre><code class="language-python">inputTag = driver.find_element_by_id('kw')
submitTag = driver.find_element_by_id('su')

actions = ActionChains(driver)
actions.move_to_element(inputTag)
actions.send_keys_to_element(inputTag,'python')
actions.move_to_element(submitTag)
actions.click(submitTag)
actions.perform()
</code></pre>
<p>还有更多的鼠标相关的操作。</p>
<ul>
<li>click_and_hold(element)：点击但不松开鼠标。</li>
<li>context_click(element)：右键点击。</li>
<li>double_click(element)：双击。 更多方法请参考：http://selenium-python.readthedocs.io/api.html</li>
</ul>
<h4 id="cookie操作">Cookie操作：</h4>
<ol>
<li>
<p>获取所有的</p>
<pre><code>cookie
</code></pre>
<p>：</p>
<pre><code class="language-python"> for cookie in driver.get_cookies():
     print(cookie)
</code></pre>
</li>
<li>
<p>根据cookie的key获取value：</p>
<pre><code class="language-python"> value = driver.get_cookie(key)
</code></pre>
</li>
<li>
<p>删除所有的cookie：</p>
<pre><code class="language-python"> driver.delete_all_cookies()
</code></pre>
</li>
<li>
<p>删除某个</p>
<pre><code>cookie
</code></pre>
<p>：</p>
<pre><code class="language-python"> driver.delete_cookie(key)
</code></pre>
</li>
</ol>
<h4 id="页面等待">页面等待：</h4>
<p>现在的网页越来越多采用了 Ajax 技术，这样程序便不能确定何时某个元素完全加载出来了。如果实际页面等待时间过长导致某个dom元素还没出来，但是你的代码直接使用了这个WebElement，那么就会抛出NullPointer的异常。为了解决这个问题。所以 Selenium 提供了两种等待方式：一种是隐式等待、一种是显式等待。</p>
<ol>
<li>
<p>隐式等待：调用<code>driver.implicitly_wait</code>。那么在获取不可用的元素之前，会先等待10秒中的时间。示例代码如下：</p>
<pre><code class="language-python">driver = webdriver.Chrome(executable_path=driver_path)
driver.implicitly_wait(10)
# 请求网页
driver.get(&quot;https://www.douban.com/&quot;)
</code></pre>
</li>
<li>
<p>显示等待：显示等待是表明某个条件成立后才执行获取元素的操作。也可以在等待的时候指定一个最大的时间，如果超过这个时间那么就抛出一个异常。显示等待应该使用<code>selenium.webdriver.support.excepted_conditions</code>期望的条件和<code>selenium.webdriver.support.ui.WebDriverWait</code>来配合完成。示例代码如下：</p>
<pre><code class="language-python"> from selenium import webdriver
 from selenium.webdriver.common.by import By
 from selenium.webdriver.support.ui import WebDriverWait
 from selenium.webdriver.support import expected_conditions as EC

 driver = webdriver.Firefox()
 driver.get(&quot;http://somedomain/url_that_delays_loading&quot;)
 try:
     element = WebDriverWait(driver, 10).until(
         EC.presence_of_element_located((By.ID, &quot;myDynamicElement&quot;))
     )
 finally:
     driver.quit()
</code></pre>
</li>
<li>
<p>一些其他的等待条件：</p>
<ul>
<li>
<p>presence_of_element_located：某个元素已经加载完毕了。</p>
</li>
<li>
<p>presence_of_all_emement_located：网页中所有满足条件的元素都加载完毕了。</p>
</li>
<li>
<p>element_to_be_cliable：某个元素是可以点击了。</p>
<p>更多条件请参考：http://selenium-python.readthedocs.io/waits.html</p>
</li>
</ul>
</li>
</ol>
<h4 id="切换页面">切换页面：</h4>
<p>有时候窗口中有很多子tab页面。这时候肯定是需要进行切换的。<code>selenium</code>提供了一个叫做<code>switch_to_window</code>来进行切换，具体切换到哪个页面，可以从<code>driver.window_handles</code>中找到。示例代码如下：</p>
<pre><code class="language-python"># 打开一个新的页面
self.driver.execute_script(&quot;window.open('&quot;+url+&quot;')&quot;)
# 切换到这个新的页面中
self.driver.switch_to_window(self.driver.window_handles[1])
</code></pre>
<h4 id="设置代理ip">设置代理ip：</h4>
<p>有时候频繁爬取一些网页。服务器发现你是爬虫后会封掉你的ip地址。这时候我们可以更改代理ip。更改代理ip，不同的浏览器有不同的实现方式。这里以<code>Chrome</code>浏览器为例来讲解：</p>
<pre><code class="language-python">from selenium import webdriver

options = webdriver.ChromeOptions()
options.add_argument(&quot;--proxy-server=http://110.73.2.248:8123&quot;)
driver_path = r&quot;D:\ProgramApp\chromedriver\chromedriver.exe&quot;
driver = webdriver.Chrome(executable_path=driver_path,chrome_options=options)

driver.get('http://httpbin.org/ip')
</code></pre>
<h4 id="webelement元素"><code>WebElement</code>元素：</h4>
<p><code>from selenium.webdriver.remote.webelement import WebElement</code>类是每个获取出来的元素的所属类。<br>
有一些常用的属性：</p>
<ol>
<li>get_attribute：这个标签的某个属性的值。</li>
<li>screentshot：获取当前页面的截图。这个方法只能在<code>driver</code>上使用。<br>
<code>driver</code>的对象类，也是继承自<code>WebElement</code>。<br>
更多请阅读相关源代码。</li>
</ol>

                        </div>
                        <section class="post-copyright">

                            <p class="copyright-item">
                                <span>Author:</span>
                                <span>💤ISpiker</span>
                            </p>

                            <p class="copyright-item">
                                <span>Permalink:</span>
                                <span><a href="https://hehelv.github.io//post/13-dong-tai-wang-ye-pa-chong">https://hehelv.github.io//post/13-dong-tai-wang-ye-pa-chong</a></span>
                            </p>

                            <p class="copyright-item">
                                <span>License:</span>
                                <span>MIT License</span>
                            </p>

                        </section>
                        <section class="post-tags">
                            <div>
                                <span>Tag(s):</span>
                                <span class="tag">
                                
                                
                                <a href="https://hehelv.github.io//tag/Spider Note"># Python爬虫笔记</a>
                                
                                
                            </span>
                            </div>
                            <div>
                                <a href="javascript:window.history.back();">back</a>
                                <span>·</span>
                                <a href="#">home</a>
                            </div>
                        </section>
                        <section class="post-nav">
                            
                                <a class="prev" rel="prev" href="https://hehelv.github.io//post/13-tu-xing-yan-zheng-ma-shi-bie">
                                    14-图形验证码识别
                                </a>
                                
                                    
                                        <a class="next" rel="next" href="https://hehelv.github.io//post/1-duo-xian-cheng-pa-chong">
                                            12-多线程爬虫
                                        </a>
                                        
                        </section>

                    </article>
                </div>
                
            </div>
    </div>
    </div>

    </div>
    <footer id="footer" class="footer">
    <div class="copyright">
        

            <script>
                var xhr = new XMLHttpRequest();
                xhr.open('get', 'https://v1.hitokoto.cn');
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        var data = JSON.parse(xhr.responseText);
                        var hitokoto = document.getElementById('hitokoto');
                        hitokoto.innerText = data.hitokoto;
                    }
                }
                xhr.send();
                (function() {
                    var bp = document.createElement('script');
                    var curProtocol = window.location.protocol.split(':')[0];
                    if (curProtocol === 'https') {
                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                    } else {
                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                    }
                    var s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(bp, s);
                })();
            </script>
            <b id="hitokoto"></b><br>
            <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face"><path d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z" fill="#93b5cf"></path></svg>
            <script>
                var date = new Date();
                document.write(" " + date.getFullYear() + "年" + (date.getMonth() + 1) + "月" + date.getDate() + "日" + " 星期" + "日一二三四五六".charAt(date.getDay()));
            </script> Copyright&copy;
            💤ISpiker | Powered by <a href="https://coding.net" target="_blank">Coding.net</a>

    </div>
</footer>
<script>
    hljs.initHighlighting();
</script>
        </div>
</body>

</html>